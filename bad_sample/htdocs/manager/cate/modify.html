<?
	# 패스 및 클래스
	include $_SERVER[DOCUMENT_ROOT]."/Root_Path.inc";
	include "variable_config.inc";

	# DB 접속 및 함수
	include "logon.inc";
	include "user_function.inc";

	# 변수 및 설정
	include "config.inc";
	include "t_config.inc";


	// 해당 레코드셋을 구한다.
	include "t.inc";

	# 코드 중복여부 체크
	if($po_cd != $fr_cd)
	{
		$query = "SELECT COUNT(*) FROM $cf_table_cod_nm WHERE CD = '$fr_cd'";
		if($DB->Value($query))
		{
			error_msg("입력하신 코드는 이미 존재 합니다.\\n\\n 다시 입력하여 주십시오.", "back");
			exit;
		}

		# 현재코드의 하위코드가 존재하는지 체크
		$query = "SELECT COUNT(*) FROM $cf_table_cod_nm WHERE GB = '$po_cd'";
		if($DB->Value($query))
		{
			error_msg("하위코드가 존재하기 때문에 코드를 수정하실 수 없습니다.", "back");
			exit;
		}
	}

	# --------------------------------------------------------------- #
	#	화일 업로드 처리 시작
	# --------------------------------------------------------------- #
	$tm_file_nm = $my_nm_desc;
	if(is_uploaded_file($_FILES[userfile][tmp_name]) || $fr_file_del == "Y")
	{
		$tm_file_path = "";
		$tm_file_path = $cf_savedir . "/" . $my_nm_desc;
		$tm_real_file_physical = $cf_doc_root.$tm_file_path;

		if(is_file($tm_real_file_physical) && !Delete_File($tm_real_file_physical)) {
			error_msg("화일을 삭제하는데 실패했습니다.", "back");
			exit;
		} else {
			$tm_file_nm = "";
		}
		if($fr_file_del != "Y") {
			$tm_file_path =$_FILES[userfile][name];
			$cf_savedir_physical = $cf_doc_root.$cf_savedir;
			if(Upload_File($_FILES[userfile], $cf_savedir_physical, $cf_attach_size, $tm_file_path, 1))
			{
				$tm_file_nm = $tm_file_path;
			}
		}
	}
	$tm_file_nm2 = $my_bigo;
	if(is_uploaded_file($_FILES[userfile2][tmp_name]) || $fr_file_del2 == "Y")
	{
		$tm_file_path = "";
		$tm_file_path = $cf_savedir . "/" . $my_bigo;
		$tm_real_file_physical = $cf_doc_root.$tm_file_path;

		if(is_file($tm_real_file_physical) && !Delete_File($tm_real_file_physical)) {
			error_msg("화일을 삭제하는데 실패했습니다.", "back");
			exit;
		} else {
			$tm_file_nm2 = "";
		}
		if($fr_file_del2 != "Y") {
			$tm_file_path =$_FILES[userfile2][name];
			$cf_savedir_physical = $cf_doc_root.$cf_savedir;
			if(Upload_File($_FILES[userfile2], $cf_savedir_physical, $cf_attach_size, $tm_file_path, 1))
			{
				$tm_file_nm2 = $tm_file_path;
			}
		}
	}

	# --------------------------------------------------------------- #
	#	입력값 설정
	# --------------------------------------------------------------- #
	# 공개여부
	//$tm_it_service_yn = $fr_it_service_yn ? "Y" : "N";

	// 작성자관련정보 설정
	$signdate = time();
	$tm_input_id = $cf_cook_id ? $cf_cook_id : "";
	$tm_input_nm = $cf_cook_nick_nm ? $cf_cook_nick_nm : $cf_cook_nm;
	$tm_input_ip = $_SERVER[REMOTE_ADDR];
	$tm_input_ymdhms = date("YmdHis", $signdate);
	$tm_sign_id = $tm_input_id;
	$tm_sign_nm = $tm_input_nm;
	$tm_sign_ip = $tm_input_ip;
	$tm_sign_ymdhms = $tm_input_ymdhms;

	# --------------------------------------------------------------- #
	#	상품정보 업데이트
	# --------------------------------------------------------------- #
	$query = "UPDATE $cf_table_cod_nm " .
				"SET " .
					"GB = '$po_gb', " .
					"CD = '$fr_cd', " .
					"NM = '$fr_nm', " .
					"CON_CD = '$fr_con_cd', " .
					"NM_DESC = '$tm_file_nm', " .
					"ENM = '$fr_enm', " .
					"BIGO = '$tm_file_nm2', " .
					"SIGN_ID = '$tm_sign_id', " .
					"SIGN_NM = '$tm_sign_nm', " .
					"SIGN_IP = '$tm_sign_ip', " .
					"SIGN_YMDHMS = '$tm_sign_ymdhms' " .
				"WHERE GB = '$po_gb' AND CD = '$po_cd'";

	$DB->Update_Query($query);

	// 상세보기 폼으로 이동
	error_msg("", "listbody.html?$po_adv_query&po_gb=$po_gb&po_cd=$fr_cd&page=$page");	

	# DB 접속종료
	include "logoff.inc";
?>
