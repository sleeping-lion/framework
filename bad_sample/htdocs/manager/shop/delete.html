<?
	# 패스 및 클래스
	include $_SERVER[DOCUMENT_ROOT]."/Root_Path.inc";
	include "variable_config.inc";

	# DB 접속 및 함수
	include "logon.inc";
	include "user_function.inc";

	# 변수 및 설정
	include "config.inc";
	include "t_config.inc";

	if(!$po_no)
	{
		error_msg("삭제할 수 없습니다.", "back");
		exit;
	}

	// 해당 레코드셋을 구한다.
	include "t.inc";

	# --------------------------------------------------------------- #
	#	화일 삭제
	# --------------------------------------------------------------- #

	foreach ($cf_upload_nm as $uk=>$uv) {
		
		$tm_real_path = "";
		$tm_real_path = $cf_savedir . "/" . $my_no.$cf_upload_nm[$uk].".".$img_arr[$uk];
		$tm_real_path_physical = $cf_doc_root.$tm_real_path;
		
		if(is_file($tm_real_path_physical) && !Delete_File($tm_real_path_physical)) {
			error_msg("$cf_upload_column_nm[$uk] 기존 첨부화일을 삭제하는데 실패했습니다.", "back");
			exit;
		}
	}

	# --------------------------------------------------------------- #
	#	상품정보삭제
	# --------------------------------------------------------------- #
	$query = "DELETE FROM $cf_table_img_nm WHERE IT_NO = '$my_it_no'";
	$DB->Delete_Query($query);

	$query = "DELETE FROM $cf_table_col_nm WHERE NO = '$po_no'";
	$DB->Delete_Query($query);

	// 상품 리뷰 삭제
	$query="SELECT P_NO,REAL_PATH FROM CM_SHOP_COMM_T WHERE P_NO='$po_no'";
	$arr=$DB->Pipe_Arr($query);
	$tm_real_path = "";
	$tm_real_path_physical = $cf_doc_root."/files/shop.5/";
	
	for($i=0;$i<count($arr);$i++){
		if(is_file($tm_real_path_physical.$arr[$i][REAL_PATH]) && !Delete_File($tm_real_path_physical.$arr[$i][REAL_PATH])) {
			error_msg("$cf_upload_column_nm[$uk] 기존 리뷰 파일을 삭제하는데 실패했습니다.", "back");
			exit;
		}
	}

	$query = "DELETE FROM CM_SHOP_COMM_T WHERE P_NO = '$po_no'";
	$DB->Delete_Query($query);
	
	// 상품 토크 삭제
	$query = "DELETE FROM CM_SHOP_TALK_T  WHERE GOODS_NO = '$po_no'";
	$DB->Delete_Query($query);

	# 페이지 이동
	error_msg("", "list.html?$po_adv_query&page=$page");

	# DB 접속종료
	include "logoff.inc";
?>