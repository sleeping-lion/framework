<?
	# 패스 및 클래스
	include $_SERVER[DOCUMENT_ROOT]."/Root_Path.inc";
	include "variable_config.inc";

	# DB 접속 및 함수
	include "logon.inc";
	include "user_function.inc";

	# 변수 및 설정
//	include "config.inc";
	include "t_config.inc";

	//================================================================
	// 첨부화일 경로
	$cf_savedir = "/files/$a_gb.$a_cd";
	$cf_savedir_physical = $_SERVER[DOCUMENT_ROOT] . $cf_savedir;

//넘어온 게시물 넘버값
	if (!$fr_del_no){ 
		$fr_del_no = $po_no . ",";
	}
//쉼표와 분리하기
	$arr_del_no = split(",",$fr_del_no);
//	print_r($arr_del_no);


for ($i=0 ; $i < sizeof($arr_del_no) - 1 ; $i++) {	

	//게시물 넘버값 설정하기
	$tm_del_no = $arr_del_no[$i];

	$query = "select * from CM_BOARD_T " .
				" WHERE no = '$tm_del_no'";
	$arr = $DB->Pipe_Arr($query);
	//print_r($arr);
	//첨부파일 삭제하기
	for($j=0; $j<sizeof($arr_del_no)-1; $j++){
	
		########################################################################
		// 1.첨부화일 삭제
		$tm_file_path_physical = $cf_savedir_physical . "/" . $arr[$j][REAL_PATH];
		if(is_file($tm_file_path_physical) && !Delete_File($tm_file_path_physical)){
			error_msg("첨부화일을 삭제하는데 실패했습니다.", "back");
			exit;
		}
		// 2.첨부화일 삭제
		$tm_file_path_physical1 = $cf_savedir_physical . "/" . $arr[$j][REAL_PATH1];
		if(is_file($tm_file_path_physical1) && !Delete_File($tm_file_path_physical1)){
			error_msg("첨부화일을 삭제하는데 실패했습니다.", "back");
			exit;
		}
		// 3.첨부화일 삭제
		$tm_file_path_physical2 = $cf_savedir_physical . "/" . $arr[$j][REAL_PATH2];
		if(is_file($tm_file_path_physical2) && !Delete_File($tm_file_path_physical2)){
			error_msg("첨부화일을 삭제하는데 실패했습니다.", "back");
			exit;
		}
		// 4.첨부화일 삭제
		$tm_file_path_physical3 = $cf_savedir_physical . "/" . $arr[$j][REAL_PATH3];
		if(is_file($tm_file_path_physical3) && !Delete_File($tm_file_path_physical3)){
			error_msg("첨부화일을 삭제하는데 실패했습니다.", "back");
			exit;
		}

	}
	// 코멘트 삭제
	$query = "DELETE FROM CM_BOARD_COMM_T WHERE P_NO = '$tm_del_no'";
	
	$DB->Delete_Query($query);

	// 레코드 삭제
	$query = "DELETE FROM CM_BOARD_T WHERE NO = '$tm_del_no'";
	
	$DB->Delete_Query($query);
	
}
	
	// 삭제 후 list 페이지로 이동
	error_msg("", "list.html?$po_adv_query&page=$page");

	# DB 접속종료
	include "logoff.inc";
?>


