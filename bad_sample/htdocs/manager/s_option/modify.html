<?
	# 패스 및 클래스
	include "Root_Path.inc";
	include "variable_config.inc";

	# DB 접속 및 함수
	include "logon.inc";
	include "user_function.inc";

	# 변수 및 설정
	include "config.inc";
	include "t_config.inc";

	if(!$po_no)
	{
		error_msg("수정할 수 없습니다.", "back");
		exit;
	}

	// 해당 레코드셋을 구한다.
	include "t.inc";

	for($i=0; $i < count($img_arr); $i++) {
		$tm_file_ext[$i] = $img_arr[$i];
	}

	# --------------------------------------------------------------- #
	#	화일 업로드 처리 시작
	# --------------------------------------------------------------- #
	foreach ($cf_upload_nm as $uk=>$uv) {
		if(is_uploaded_file($_FILES[userfile][tmp_name][$uk]) || $fr_file_del[$uk] == "Y") {
	
			$tm_real_path = "";
			$tm_real_path = $cf_savedir . "/" . $my_no.$cf_upload_nm[$uk].".".$img_arr[$uk];;
			$tm_real_path_physical = $cf_doc_root.$tm_real_path;
			
			if(is_file($tm_real_path_physical) && !Delete_File($tm_real_path_physical)) {
				error_msg("$cf_upload_column_nm[$uk] 기존 첨부화일을 삭제하는데 실패했습니다.", "back");
				exit;
			}
			if($fr_file_del[$uk] != "Y") {

				$tm_file_ext[$uk] = substr($_FILES[userfile][name][$uk],strrpos($_FILES[userfile][name][$uk],".")+1);	// 파일 확장자 구하기
				$tm_upload_name = $my_no.$cf_upload_nm[$uk].".".$tm_file_ext[$uk];	// 저장 파일명 만들기

				if(!Upload_Files($_FILES[userfile],$uk,$cf_savedir_physical,$cf_attach_size,$tm_upload_name,1)) {
					error_msg("$cf_upload_column_nm[$fk] 업로드 실패 다시 시도해 주세요.","back");
					exit;
				}
			}
		}		
	}


	// 이스케이프
	$fr_it_name = escape_string($fr_it_name);
	$fr_it_company = escape_string($fr_it_company);
	$fr_it_memo = escape_string($fr_it_memo);

	# --------------------------------------------------------------- #
	#	입력값 설정
	# --------------------------------------------------------------- #

	// 작성자관련정보 설정
	$signdate = time();
	$tm_input_id = $cf_cook_id ? $cf_cook_id : "";
	$tm_input_nm = $cf_cook_nick_nm ? $cf_cook_nick_nm : $cf_cook_nm;
	$tm_input_ip = $_SERVER[REMOTE_ADDR];
	$tm_input_ymdhms = date("YmdHis", $signdate);
	$tm_sign_id = $tm_input_id;
	$tm_sign_nm = $tm_input_nm;
	$tm_sign_ip = $tm_input_ip;
	$tm_sign_ymdhms = $tm_input_ymdhms;

	# --------------------------------------------------------------- #
	#	상품정보 업데이트
	# --------------------------------------------------------------- #
	$query = "UPDATE $cf_table_col_nm SET " . 
						"IT_LCLASS = '$fr_it_lclass', " .
						"IT_MCLASS = '$fr_it_mclass', " .
						"IT_SCLASS = '$fr_it_sclass', " .
						"IT_MODEL_NO = '$fr_it_model_no', " .
						"IT_NAME = '$fr_it_name', " .
						"IT_EVENT_CD = '$fr_it_event_cd', " .
						"IT_BRAND_CD = '$fr_it_brand_cd', " .
						"IT_COMPANY = '$fr_it_company', " .
						"IT_CNT = '$fr_it_cnt', " .
						"IT_PRICE = '$fr_it_price', " .
						"IT_PRICE1 = '$fr_it_price1', " .
						"IT_PRICE2 = '$fr_it_price2', " .
						"IT_SALE_PRICE = '$fr_it_sale_price', " .
						"IT_SALE_PRICE1 = '$fr_it_sale_price1', " .
						"IT_SALE_PRICE2 = '$fr_it_sale_price2', " .
						"IT_SALE_PER = '$fr_it_sale_per', " .
						"IT_SAVE_PRICE = '$fr_it_save_price', " .
						"IT_SAVE_PRICE1 = '$fr_it_save_price1', " .
						"IT_SAVE_PRICE2 = '$fr_it_save_price2', " .
						"IT_SAVE_PER = '$fr_it_save_per', " .
						"IT_PRICE_UNIT = '$fr_it_price_unit', " .
						"IT_POS = '$fr_it_pos', " .
						"IT_ETC = '$fr_it_etc', " .
						
						//관련상품
						"IT_FRIEND = '$fr_friend_value', " .
						//옵션상품
						"IT_OPTION = '$fr_option_value', " .
						"IT_OPTION1 = '$fr_option1_value', " .
						"IT_OPTION2 = '$fr_option2_value', " .

						"IT_MEMO = '$fr_it_memo', " .
						"IT_SELL_YN = '$fr_it_sell_yn', " .
						"IT_SERVICE_YN = '$fr_it_service_yn', " .
						"SIGN_ID = '$tm_sign_id', " .
						"SIGN_NM = '$tm_sign_nm', " .
						"SIGN_IP = '$tm_sign_ip', " .
						"SIGN_YMDHMS = '$tm_sign_ymdhms', " .
            "BASONG_YN = '$fr_basong_yn' " .
					"WHERE NO = '$po_no'";

	$DB->Update_Query($query);


	# --------------------------------------------------------------- #
	#	상품이미지정보 업데이트
	# --------------------------------------------------------------- #
	$query = "UPDATE OPTION_IMG SET " . 
						"EXT1 = '".$tm_file_ext[0]."', " .
						"EXT2 = '".$tm_file_ext[1]."', " .
						"EXT3 = '".$tm_file_ext[2]."', " .
						"EXT4 = '".$tm_file_ext[3]."', " .
						"EXT5 = '".$tm_file_ext[4]."', " .
						"EXT6 = '".$tm_file_ext[5]."', " .
						"EXT7 = '".$tm_file_ext[6]."', " .
						"EXT8 = '".$tm_file_ext[7]."', " .
						"EXT9 = '".$tm_file_ext[8]."', " .
						"EXT10 = '".$tm_file_ext[9]."', " .
						"SIGN_ID = '$tm_sign_id', " .
						"SIGN_NM = '$tm_sign_nm', " .
						"SIGN_IP = '$tm_sign_ip', " .
						"SIGN_YMDHMS = '$tm_sign_ymdhms' " .
					"WHERE IT_NO = '$my_it_no'";

	$DB->Update_Query($query);

	
	// 페이지 이동
	error_msg("", "listbody.html?$po_adv_query&page=$page&po_no=$po_no");

	# DB 접속종료
	include "logoff.inc";
?>
