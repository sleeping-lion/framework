<?
include $_SERVER[DOCUMENT_ROOT]."/Root_Path.inc";
include "variable_config.inc";
include "logon.inc";
include "user_function.inc";
include "t_config.inc";
	
#data mapping
#최종 수정일(처리일자)
$signdate = time();
$tm_sign_ymdhms    = date("YmdHis",$signdate);

#배송일자
$tm_sen_date = substr($tm_sign_ymdhms, 0, 8);

#반송일자
$tm_return_date = substr($tm_sign_ymdhms, 0, 8);

#반송사유
$tm_return_reason = stripslashes($fr_reson);

#반품일자
//$tm_rebuff_date = substr($tm_sign_date, 0, 8);
#반품사유
//$tm_rebuff_reason = stripslashes($fr_rebuff_reason);
if($ck_cook_id){
	$tm_writer   = $ck_cook_id;
}

$tm_input_ip = $_SERVER[REMOTE_ADDR];


	#Update Query
foreach($check_v as $k=>$v) {
	switch($cheri_update_value){
		case("50"): #배송신청
			$order_update_yn = "Y";
			$upd_order_value = " SET ".
							" PROGRESS = '$cheri_update_value', ".	#처리상태변경
							" SEN_DATE = '$tm_sen_date', ".			#배송일자입력
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".	#처리일자입력
							" WRITER = '$tm_writer', ". 
							" INPUT_IP = '$tm_input_ip' ";
			$cart_update_yn = "Y";
			$upd_cart_value = " SET ".
							" CHERI_CD = '$cheri_update_value', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
		break;
		case("60"): #배송중
			$order_update_yn = "Y";
			$upd_order_value = " SET ".
							" PROGRESS = '$cheri_update_value', ".	#처리상태변경
							" SEN_DATE = '$tm_sen_date', ".			#배송일자입력
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".	#처리일자입력
							" WRITER = '$tm_writer', ". 
							" INPUT_IP = '$tm_input_ip' ";
			$cart_update_yn = "Y";
			$upd_cart_value = " SET ".
							" CHERI_CD = '$cheri_update_value', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
		break;
		case("70"): #배송완료
			$order_update_yn = "Y";
			$upd_order_value = " SET ".
							" PROGRESS = '$cheri_update_value', ".
							" SEN_DATE = '$tm_sen_date', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
			$cart_update_yn = "Y";
			$upd_cart_value = " SET ".
							" CHERI_CD = '$cheri_update_value', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
		break;
		case("80"): #반송
			$order_update_yn = "Y";
			$upd_order_value = " SET ".
							" PROGRESS = '$cheri_update_value', ".
							" RETURN_DATE = '$tm_return_date', ".
							" RETURN_REASON = '$tm_return_reason', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
			$cart_update_yn = "Y";
			$upd_cart_value = " SET ".
							" CHERI_CD = '$cheri_update_value', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
		break;		
		case("100"): #완료
			$order_update_yn = "Y";
			$upd_order_value = " SET ".
							" PROGRESS = '$cheri_update_value', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
			$cart_update_yn = " Y";
			$upd_cart_value = " SET ".
							" CHERI_CD = '$cheri_update_value', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
		break;
		case("120"): #환불
			$order_update_yn = "Y";
			$upd_order_value = " SET ".
							" PROGRESS = '$cheri_update_value', ".
							" SIGN_YMDHMS = '$tm_sign_ymdhms', ".
							" WRITER = '$tm_writer', ".
							" INPUT_IP = '$tm_input_ip' ";
			$cart_update_yn = " N";
		break;
		default:
	}

	$upd_to_order = "UPDATE  " . $cf_table_ord_nm ;
	$upd_to_cart = "UPDATE  "  . $cf_table_car_nm ;

	$upd_order_where = " WHERE ORDER_NO = '$v' ";
	$upd_cart_where = " WHERE ORDER_NO = '$v' ";

	$upd_order_query = $upd_to_order.$upd_order_value.$upd_order_where;

	$upd_cart_query = $upd_to_cart.$upd_cart_value.$upd_cart_where;

	#order_t를 update한다.
	if($order_update_yn == "Y"){
		$DB->Insert_Query($upd_order_query);
	}

	#cart_t를 업뎃한다.
	if($cart_update_yn == "Y"){
		$DB->Insert_Query($upd_cart_query);
	}
}



# 관리자로 인증된 경우에만 모든 글을 수정할 수 있다. 
include "logoff.inc";

error_msg("","list.html?$po_adv_query");
exit;
?>
