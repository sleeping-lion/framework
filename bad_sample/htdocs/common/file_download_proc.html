<?
	include "Root_Path.inc";
	include "variable_config.inc";
	include "user_function.inc";

	# --------------------------------------------------------- #
	#	파일 이름 바꾸어서 다운로드 하기
	#
	#	*- 주의 첨부파일 size가 큰경우 시스템 리소스를 과다하게 사용함 -*
	# --------------------------------------------------------- #
	$file = base64_decode($file);
	
	$file = $_SERVER["DOCUMENT_ROOT"].$file;
	//echo $file;

	
	if(is_file($file))
	{
		# ---- 파일 스트림을 연다. ---- #
		$fp		= fopen($file,"r");
		$size	= filesize($file);
		$stream	= fread($fp,$size);
		fclose($fp);

		# ---- download를 위한 스트림을 연다. ---- #
		$filename = basename($file);
		$filename = substr($filename, strpos($filename, "_")+1);

		# ---- download를 위한 헤더를 생성하고 스트림을 뿌린다. ---- #
		header("Content-type: application/octet-stream");
		header("Content-Disposition: attachment; filename=" .$filename);
		echo ($stream);
	}
	else
	{
		error_msg("요청하신 파일이 존재하지 않습니다.\\n\\n관리자 에게 문의하세요.!", "back");
		exit;
	}
?>
