<?
	# 패스 및 클래스
	include $_SERVER[DOCUMENT_ROOT]."/Root_Path.inc";
	include "variable_config.inc";

	# DB 접속 및 함수
	include "logon.inc";
	include "user_function.inc";

	# 변수 및 설정
	include "config.inc";
	include "t_config.inc";

	# 상단 HTML
	$JS = "<script language=\"javascript\" src=\"t.js\"></script>\n";
	$ONLOAD = "focusSubject()";
	include "top.inc";
	include "t_top.inc";

	// 선택한 게시물의 입력값을 뽑아낸다.
	include "t.inc";

	// 비공개글인경우
	if($my_public_yn == "N")
	{
		if($my_sort == ceil($my_sort))
		{
			$tm_original_id = $my_input_id;
		}
		else
		{
			// 원글의 입력아이디를 가져온다.
			$query = "SELECT INPUT_ID FROM $cf_table_col_nm WHERE SORT = " . ceil($my_sort);
			$tm_original_id = $DB->Value($query);
		}

		if($cf_top_level_yn != "Y" && (!$cf_cook_id || ($cf_cook_id != $my_input_id && $cf_cook_id != $tm_original_id)))
		{
			error_msg("답변 권한이 없습니다.", "back");
			exit;
		}
	}

	# 공지글에는 답변을 달 수 없다.
	if($my_notice_yn == "Y")
	{
		error_msg("공지글에는 답변을 달 수 없습니다.", "back");
		exit;
	}

	# ---------------------------------------------------- #
	#	폼에서 필요한 정보를 정의한다.
	# ---------------------------------------------------- #
	// 답변폼 초기값
	$my_input_nm = $cf_cook_nick_nm ? $cf_cook_nick_nm : ($cf_cook_nm ? $cf_cook_nm : "");
	$my_email = $cf_cook_email ? $cf_cook_email : "";
	$my_homepage = "http://";

	// 원글자체가 다른글의 응답글일 경우 문자열 중복을 피하기 위해 "[RE]" 를 없앤고 "[RE]" 를 붙인다.
	$my_subject = eregi_replace("^\[RE\] ", "",$my_subject);
	$my_subject = "[RE] " . $my_subject;

	// 원글과 답변글의 차이를 위해 원글의 맨 앞에 > 추가
	$tm_line1 = "\n\n\n";
	$tm_line2 = "-------------------------------------";
	$my_memo = ">" . $my_memo;
	$my_memo = eregi_replace("\n", "\n>", $my_memo);
	$my_memo = $tm_line1 . $tm_line2 . $my_input_nm . "님의 글입니다.\n\n" . $my_memo;

	// 첨부화일 최대용량
	$sys_attach_size = getMaxUploadSize();
	$tm_attach_size = $cf_attach_size * 1000;
	if($sys_attach_size < $tm_attach_size)
	{
		$tm_attach_size = $sys_attach_size;
	}
	$tm_attach_size = (int)($tm_attach_size / 104857.6) / 10;

	# ------------------------------------------------------------------- #
	#	옵션 - 원글의 설정 그대로(비밀글여부, 서비스가능여부)
	# ------------------------------------------------------------------- #
	// TEXT / HTML 사용여부
	$tm_html_y_checked = "";
	$tm_html_n_checked = "checked";

	// 비밀글 여부
	if($my_public_yn == "Y")
		$tm_public_yn_msg = "공개글";
	else
		$tm_public_yn_msg = "비밀글";

	// 서비스가능여부
	if($my_service_yn == "Y")
		$tm_service_yn_msg = "서비스불능";
	else
		$tm_service_yn_msg = "서비스중";

	// 서비스(공개) 가능여부 - 원글을 따라간다.
	if($my_service_yn == "Y")
	{
		$tm_service_y_check = "checked";
		$tm_service_yn_checked = "checked";
	}
	else
	{
		$tm_service_n_check = "checked";
		$tm_service_yn_checked = "";
	}

	// 버튼관련변수 정의 - 글올리기 버튼
	$LIST = "<a href='list.html?$po_adv_query'><img src='$cf_images_dir/list.gif'></a>";
	$POST = "<input type='image' src='$cf_images_dir/post.gif'>";
	$CANCEL = "<img src='$cf_images_dir/cancel.gif' onClick='history.back()' style='cursor:hand'>";

	# 비밀번호 없이 쓰기가능여부 (회원이경우)
	$POST_YN = $cf_cook_id ? "Y" : "N";
?>
<form name="signform" enctype="multipart/form-data" method="post" action="reply.html?<?=$po_adv_query?>&page=<?=$page?>&po_no=<?=$po_no?>" onSubmit="return checkIt('<?=$POST_YN?>')">
<?
	// 쓰기폼
	include $cf_skin_nm . "/replyform.inc";
?>
</form>
<?
	# 하단 HTML
	include "t_footer.inc";
	include "footer.inc";

	# DB 접속종료
	include "logoff.inc";
?>
