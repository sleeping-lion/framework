<?
	# 패스 및 클래스
	include "variable_config.inc";

	# DB 접속 및 함수
	include "logon.inc";
	include "user_function.inc";

	# 변수 및 설정
	include "config.inc";
	include "t_config.inc";

	if(!$cf_cook_id){
			error_msg("로그인이 필요합니다.","back");
			exit;
	}

	# 데이터의 타당성 검사
	if(!$fr_comm_memo)
	{
		error_msg("내용을 입력해주세요.");
		exit;
	}

	if(!$fr_comm_input_nm)
	{
		error_msg("이름을 입력해주세요.", "back");
		exit;
	}

//	if(!$fr_comm_passwd || strlen($fr_comm_passwd) < 4)
//	{
//		error_msg("패스워드는 4자이상 입력해주세요.", "back");
//		exit;
//	}

	# 코멘트 번호 설정
	$query = "SELECT MAX(C_NO) FROM CM_BOARD_COMM_T WHERE P_NO = '$po_no'";
	$my_c_no = $DB->Value($query) + 1;

	# 본문 특수문자를 escape 시킨다.
	$fr_comm_memo = escape_string($fr_comm_memo);
	$fr_comm_subject = escape_string($fr_comm_subject);

	# 작성자 정보
	$tm_input_ip = $_SERVER[REMOTE_ADDR];
	$tm_input_id = $cf_cook_id;
	$tm_input_nm = $fr_comm_input_nm ? $fr_comm_input_nm : $cf_cook_nm;
	$tm_input_ymdhms = date("YmdHis", time());

	# 코멘트 글 입력
	$query = "INSERT INTO CM_BOARD_COMM_T " .
				"VALUES ('$po_no', '$my_c_no', '$fr_comm_subject', '$fr_comm_memo', '$fr_comm_passwd', '$tm_input_id', '$tm_input_nm', '$tm_input_ip', '$tm_input_ymdhms')";
	$DB->Insert_Query($query);

	//통계테이블
//	include "board_counter_reply.inc";

	# 게시글에 대한 코멘트 등록수 수정
	$query = "UPDATE $cf_table_col_nm SET COMM_CNT = COMM_CNT + 1 WHERE NO = '$po_no'";
	$DB->Update_Query($query);

	# 코멘트 등록수 수정
	if($cf_cook_id)
	{
		// 코멘트 등록갯수 업데이트.
		$query = "UPDATE $cf_table_mem_nm SET CM_CMT_CNT = CM_CMT_CNT + 1 WHERE CM_ID = '$cf_cook_id'";
		$DB->Update_Query($query);
	}

	# 페이지 이동
	error_msg("", $po_uri);

	# DB 접속종료
	include "logoff.inc";
?>
