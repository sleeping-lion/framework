<?
		# 패스 및 클래스
		include $_SERVER[DOCUMENT_ROOT]."/Root_Path.inc";
		include "variable_config.inc";

		# DB 접속 및 함수
		include "logon.inc";
		include "user_function.inc";

		# 상단 HTML
		$JS = "<script language=\"javascript\" src=\"t.js\"></script>\n";
	
		include "top.inc";
		include "t_top.inc";
		
		

		# 초기값 설정
		$board = new CPaging();
		$page = $page ? $page : 1;		//page값 1
		$cf_num_per_page = 10;


		# ------------------------------------------------------------ #
		#	사용할 쿼리정리 시작
		# ------------------------------------------------------------ #
		$query_select = "SELECT * ";
		$query_select_count = "SELECT COUNT(*) ";
		$query_from = "FROM CM_BOARD_T ";
		$query_where = " WHERE SUBJECT LIKE '%".$top_key."%' AND MEMO LIKE '%".$top_key."%'  ";

		if($cf_top_level_yn != "Y")
			$query_where .= "AND SERVICE_YN = 'Y' ";

		$query_order = "ORDER BY NO DESC ";
		

		
		# ---- 전체게시물 수를 구한다. ---- #
		$query = $query_select_count .
					$query_from .
					$query_where;

		$total_record = $DB->Value($query);


		# ---- 현재페이지가 존재하지 않을경우 페이지수를 동기화한다. ----- #
		if(($page > 1) && (($page-1) * $cf_num_per_page >= $total_record))
			$page = $page - 1;



		# ---- 페이징변수 처리 (총 레코드수, 현재페이지번호, 페이지당 레코드수, 페이지블럭당 페이지 수) ---- #
		$board->Paging($total_record, $page, $cf_num_per_page, $cf_page_per_block);


		# ---- 전체 출력할 레코드를 가져온다. ---- #
		unset($arr);
		$query_limit = "LIMIT $board->first, $board->record_count";
		$query = $query_select .
					$query_from .
					$query_where .
					$query_order .
					$query_limit;

		$arr = $DB->Pipe_Arr($query);

		// ------------------------------------------------------------ //
	//	페이징처리 시작
	// ------------------------------------------------------------ //
	$P_SKIN = 1;
	$paging_skin[0] = array(
								"none" => " 1 ",
								"prev_pageblock" => "<font color='#CCCCCC'>◀|</font>",
								"prev_page" => "",
								"next_page" => "",
								"next_pageblock" => "<font color='#CCCCCC'>|▶</font>",
								"first" => "[처음]",
								"last" => "[끝]",
							);

	$paging_skin[1] = array(
								"none" => " 1 ",
								"prev_pageblock" => "<img src='$cf_images_dir/prev10.gif' border='0' align='absmiddle'>",
								"prev_page" => "<img src=\"$cf_images_dir/prev.gif\" border=0 align='absmiddle'>",
								"next_page" => "<img src='$cf_images_dir/next.gif' border='0' align='absmiddle'>",
								"next_pageblock" => "<img src='$cf_images_dir/next10.gif' border='0' align='absmiddle'>",
								"first" => "[처음]",
								"last" => "[끝]",
							);

	# ---- 첫페이지 ---- #
	if($board->total_page > 1 && $board->page != 1)
	{
		$FIRST_PAGE = "<a href='total_search.html?sm=9_1&top_key=".urlencode($top_key)."&page=1'><img src='/images/board/btn_first.gif' alt='처음' /></a>";
	}
	else
	{
		$FIRST_PAGE = "<img src='/images/board/btn_first.gif' alt='처음' />";
	}

	# ---- 마지막페이지 ---- #
	if($board->total_page > 1 && $board->total_page != $board->page)
	{
		$LAST_PAGE = "<a href='total_search.html?sm=9_1&top_key=".urlencode($top_key)."&page=" . $board->total_page . "'><img src='/images/board/btn_last.gif' alt='마지막' /></a>";
	}
	else
	{
		$LAST_PAGE = "<img src='/images/board/btn_last.gif' alt='마지막' />";
	}

	# ---- 이전페이지 블록 ---- #
	if($board->prev_pageblock)
	   $PREV_BLOCK = "<a href=\"total_search.html?sm=9_1&top_key=".urlencode($top_key)."&page=" . $board->prev_pageblock . "\" onMouseOver=\"status='load previous $page_per_block pages';return true;\" onMouseOut=\"status=''\"><img src='/images/board/btn_prev.gif' alt='이전 10페이지 이동' /></a>";
	else
	   $PREV_BLOCK = "<img src='/images/board/btn_prev.gif' alt='이전 10페이지 이동' />";

	# ---- 이전페이지 ---- #
	if($board->prev_page)
		$PREV_PAGE = "<a href=\"total_search.html?sm=9_1&top_key=".urlencode($top_key)."&page=" . $board->prev_page . "\" onMouseOver=\"status='previous page';return true;\" onMouseOut=\"status=''\">" . $paging_skin[$P_SKIN][prev_page] . "</a>";
	else
		$PREV_PAGE = $paging_skin[$P_SKIN][prev_page];

	# ---- 다음페이지 ---- #
	if($board->next_page)
	   $NEXT_PAGE = "<a href=\"total_search.html?sm=9_1&top_key=".urlencode($top_key)."&page=" . $board->next_page . "\" onMouseOver=\"status='next page';return true;\" onMouseOut=\"status=''\">" . $paging_skin[$P_SKIN][next_page] . "</a>";
	else
		$NEXT_PAGE = $paging_skin[$P_SKIN][next_page];

	# ---- 다음페이지 블록 ---- #
	if($board->next_pageblock)
		$NEXT_BLOCK = "<a href=\"total_search.html?sm=9_1&top_key=".urlencode($top_key)."&page=" . $board->next_pageblock . "\" onMouseOver=\"status='load next $page_per_block pages';return true;\" onMouseOut=\"status=''\"><img src='/images/board/btn_next.gif' alt='다음 10페이지 이동' /></a>";
	else
	   $NEXT_BLOCK = "<img src='/images/board/btn_next.gif' alt='다음 10페이지 이동' />";

	# ---- 페이지링크 ---- #
	if($board->page_count == 0)
	{
		$board->page_count = 1;
		$PAGES[$i] = "<li> <strong>" . $paging_skin[$P_SKIN][none] . "</strong> </li>";
	}
	else
	{
		for($i=0; $i<$board->page_count; $i++)
		{
			if($board->pages[$i] == $page)
				$PAGES[$i] = "<li> <strong>" . $board->pages[$i] . "</strong> </li> ";
			else
				$PAGES[$i] = "<li> <a href='total_search.html?sm=9_1&top_key=".urlencode($top_key)."&page=" . $board->pages[$i] . "'>" . $board->pages[$i] . "</a> </li>";
		}
	}
	// ------------------------------------------------------------ //
	//	페이징처리 끝
	// ------------------------------------------------------------ //


?>
<div style="border-bottom:2px solid #eee; text-align:left; color:#000000; ">
검색어 '<span style="color:red;"><?=$top_key;?></span>' 에 대해 총 <span style="color:red;"><?=number_format($total_record);?></span> 건이 검색되었습니다
</div>
		<!-- board lst -->
<ul >
	<?  for($i=0; $i<$board->record_count; $i++){
		
		  switch($arr[$i]["CD"]){
		     case "1" : $tm_sm = "3_1"; break;
			 case "2" : $tm_sm = "3_2"; break;
			 case "3" : $tm_sm = "3_3"; break;
			 case "4" : $tm_sm = "3_4"; break;
			 case "5" : $tm_sm = "3_5"; break;
			 case "6" : $tm_sm = "3_5"; break;
			 case "7" : $tm_sm = "4_1"; break;
			 case "8" : $tm_sm = "4_2"; break;
			 case "9" : $tm_sm = "4_3"; break;
			 case "10" : $tm_sm = "4_4"; break;
			 case "11" : $tm_sm = "4_4"; break;
			 case "12" : $tm_sm = "4_4"; break;
			 case "13" : $tm_sm = "5_1"; break;
			 case "14" : $tm_sm = "5_2"; break;
			 case "15" : $tm_sm = "5_3"; break;
		  }
		
	?>
	<li style="padding:10px; text-align:left; border-bottom:1px solid #eee">
		<p style="font-weight:bold;"><span style="color:#da5856;padding-right:3px;">[<?=get_table_nm($arr[$i]["GB"],$arr[$i]["CD"],$arr[$i]["ITEM"]);?>]</span>  <a href="/common/board/listbody.html?a_gb=<?=$arr[$i]["GB"];?>&a_cd=<?=$arr[$i]["CD"];?>&a_item=<?=$arr[$i]["ITEM"];?>&sm=<?=$tm_sm;?>&po_no=<?=$arr[$i]["NO"];?>"><span  style="color:#333;padding-right:10px;"><?=substr_byte(strip_tags($arr[$i]["SUBJECT"]), 50, "..");?></span></a> <span  style="width:60px;color:#adadad;font-size:11px;font-family:Arial, '돋움', Sans-serif;">[<?=substr($arr[$i]["INPUT_YMDHMS"],0,4);?>.<?=substr($arr[$i]["INPUT_YMDHMS"],4,2);?>.<?=substr($arr[$i]["INPUT_YMDHMS"],6,2);?>]</span>	
		<p><?=substr_byte(strip_tags($arr[$i]["MEMO"]), 200, "...");?></p>
	</li>
	<? } ?>
<ul>
<!-- //board_bottom -->

<!-- paging -->
<div class="paging">
	 <ul>
		<li><?=$FIRST_PAGE?></li>
		<li><?=$PREV_BLOCK?></li>
		<?
			# 페이지 링크출력
			for($i=0; $i<$board->page_count; $i++)
			{
				echo $PAGES[$i];
			}
		?>
		<li><?=$NEXT_BLOCK?></li>
		<li><?=$LAST_PAGE?></li> 
	</ul> 
</div>	
<!-- //paging -->

<br>
<br>
<?

		# 하단 HTML
		include "t_footer.inc";

		include "footer.inc";

		# DB 접속종료
		include "logoff.inc";

?>


